<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>手机-Manage</title>

	<link media="all" rel="stylesheet" href="css/cute.css" type="text/css" />
    <link media="all" rel="stylesheet" href="css/phone_manage.css" type="text/css" /> 
	<script src="http://g.tbcdn.cn/kissy/k/1.3.2/seed-min.js" type="text/javascript"></script> 
	<script src="js/config.js" type="text/javascript"></script>

	<!--================================ 项目共用配置（放到layout中）===============================-->
    <script type="text/javascript">
		// gitlab上的应用名称, 版本号
		CUTE.package('test', '1.2.6');
    </script>


</head>
<body>
    <div class="dialog" style="position: absolute; width: 100%; height: 100%; background-color: white; left: 0; top: 0; z-index: 999999; opacity: 0.5; display: none;">
        <div class="loading loading-48x48"></div>
    </div>
	<div class="page">
        <br>
        <div class="tip tip-error" id="errorMsg">2</div>
        <div class="tip tip-success" id="successMsg">2</div>
		<section class="section">
			<h1 class="section-title">手机维护管理</h1>
            <div class="section-body">
                <form action="" method="post" class="form" id="J_form">
                	<div class="row">
                        <div class="span span2 label">
                            <label for="taskId">
                                <i class="required">*</i>IMEI号段
                            </label>
                        </div>
                        <div class="span span2">
                            <input id="startRange" name="startRange" type="text" class="text" placeholder="开始范围" data-valid="{empty: true, number: ['只能为数字10-16位']}" value = ""/>
                        </div>
                        <div class="span">-</div>
                        <div class="span span2">
                            <input id="overRange" name="overRange" type="text" class="text" placeholder="结束范围" data-valid="{empty: true, number: ['只能为数字10-16位']}"/>
                            <div class="kf-msg" style=""></div>
                        </div>

                        <div class="span span2">
                            <input id="isUpload" name="security" type="checkbox" /><label for="">上传IMEI号段</label>
                        </div>
                    </div>
                    <div class="row" id="uploadWarp" style="display: none;">
                        <div class="span span2 label">
                            <label for="uploadFile">
                                <i class="required">*</i>上传IMEI号段
                            </label>
                        </div>
                        <div class="span span2">
                            <input id="uploadFile" name="uploadFile" type="file" class="file" data-valid="{empty: true, txt: true, fileSize: [180] }" data-disable="true" />
                            <img id="tempimg" dynsrc="" src="" style="display:none" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="factory">
                                <i class="required">*</i>选择厂商
                            </label>
                        </div>
                        <div class="span span3">
                            <select disabled="disabled" id="factory" name="vendor" data-valid="{empty: true}">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="phone">
                                <i class="required">*</i>选择机型
                            </label>
                        </div>
                        <div class="span span3">
                            <select disabled="disabled" id="phone" name="productName" data-valid="{empty: true}">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="plan">
                                <i class="required">*</i>方案商
                            </label>
                        </div>
                        <div class="span span3" id="plan">
                            <input id="planVal" name="solutionProviders" type="hidden" class="text" value="" data-valid="{empty: true, range50: true}" />
                        </div>
                        
                    </div>
                    <div class="row">
                    	<div class="span span2 label">
                            <label for="board">
                                主板型号
                            </label>
                        </div>
                        <div class="span span3" id="board">
                            <input id="boardVal" name="broadType" type="hidden" class="text" value="" data-valid="{range64: true}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="channel">
                                <i class="required">*</i>渠道
                            </label>
                        </div>
                        <div class="span span3">
                            <select id="channel" name="channel" data-valid="{empty: true}">
                                <option value>请选择</option>
                                <option value="线上">线上</option>
                                <option value="线下">线下</option>
                                <option value="运营商">运营商</option>
                            </select>
                            <div class="kf-msg" style=""></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="active">
                                所属活动
                            </label>
                        </div>
                        <div class="span span3" id="active">
                            <input id="activeVal" name="activity" type="hidden" class="text" value="" data-valid="{range64: true}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="number">
                                <i class="required">*</i>合同编号
                            </label>
                        </div>
                        <div class="span span3">
                            <input id="number" name="number" type="text" class="text"  data-valid="{empty: true, range64: true}"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="factory">
                                <i class="required">*</i>合同有效期
                            </label>
                        </div>
                        <div class="span span2">
                            <input id="beginTime" name="beginTime" type="text" class="text" readonly="readonly" placeholder="开始日期" data-valid="{empty: true, compare: true }" />
                        </div>
                        <div class="span" style="margin-left: -5px;">-</div>
                        <div class="span span2">
                            <input id="endTime" name="endTime" type="text" class="text" readonly="readonly" placeholder="截止日期" data-valid="{empty: true }" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="span span2 label">
                            <label for="publish">
                                发布时间
                            </label>
                        </div>
                        <div class="span span3">
                            <input id="publishTime" name="publish" type="text" class="text" placeholder="发布时间"/>
                        </div>
                    </div>

                    <div class="row">
                    	<div class="span span2 label">
                        </div>
                    	<div class="span">
                            <input type="submit" id="J_submitBtn" class="btn btn-m" value="确认">
                            <input type="button" id="J_cancelBtn" class="btn btn-m btn-weak" value="取消">
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </div>
	<!--================================ js  {{ ===============================-->
    <script src="js/cascade_select.js" type="text/javascript"></script>
    <!--<script src="js/form.js" type="text/javascript"></script> -->
    <script type="text/javascript">

    KISSY.config({
        debug: true,
        packages: [
            {
                name: "droplist",
                tag: "20130618",
                base: "js/", 
                // charset: "gbk"
            },
            {
                name: "form",
                tag: "20130618",
                base: "js/", 
                // charset: "gbk"
            }
        ]
    });

    KISSY.ready(function( S ){
    	KISSY.use('node, sizzle, ajax, gallery/validation/1.1/, CascadeSelect, form, Calendar, DropList', function (S, Node, Sizzle, IO, Validation, CascadeSelect, FormAuth, Calendar) {
            var $ = S.Node.all;

            //初始化 下拉框
            var cs = new CascadeSelect(["factory","phone"],
                //data
                // ${vendorJson}
                [{ productModel: "1", menu: [{ productModel: "2" }] }]
                ,{
                    Default: [ "${vendor}","${productName}" ],
                    ShowEmpty: true,
                    EmptyText: "\u8BF7\u9009\u62E9",
                    Txt: "productModel",    //文本key
                    Val: "productModel",    //值key
                    Sub: "menu"     //下一级key
                });
    		/**
    		 * =-----------------------------------------------------------------=
    		 * 表单校验部分
    		 * =-----------------------------------------------------------------=
    		 */

            var form = new FormAuth('#J_form',{ isAllTip: false });

            //addrule
            form.addRule( {
                compare: function(){
                    var btVal = $('#beginTime').val(),
                        etVal = $('#endTime').val(),
                        bt = new Date( btVal ).getTime(),
                        et = new Date( etVal ).getTime();

                    if( bt > et ){
                        return '开始时间大于结束时间'
                    }
                }
            });

            //calendar
            Calendar.on('dateclick', function(e) {
                form.valid('#beginTime');
                form.valid('#endTime');
            })

            $('#J_form').on('submit', function(){
                var isSubmit = form.valid();
                if( isSubmit ){
                    $('.dialog').css("display", "block");
                }
                return isSubmit;
            })

            //upload
            function upload(){
                if( $( "#isUpload" ).attr('checked') == 'checked' ){
                    $('#uploadWarp').css('display', 'block');
                    $( '#startRange' ).attr('disabled', 'true');
                    $( '#overRange' ).attr('disabled', 'true');
                    form.disable("#startRange");
                    form.disable("#overRange");
                    form.enable("#uploadFile");
                }else{
                    $('#uploadWarp').css('display', 'none');
                    $( '#startRange' ).attr('disabled', false);
                    $( '#overRange' ).attr('disabled', false);
                    form.disable("#uploadFile");
                    form.enable("#startRange");
                    form.enable("#overRange");
                };
            }
            $("#isUpload").on('click', upload );

            upload();

            //reset
            $('#J_cancelBtn').on('click', function(){
                $('#J_form input').each(function(){
                    var type = $(this).attr('type');

                    if( type !== 'submit' && type !== 'button' )
                        $( this ).val('');
                });
            })

        })
    })

	//datetime
	KISSY.add('Calendar', function(S, Node, Calendar) {
        var $ = Node.all;

        var calendar = new Calendar({
            minDate: new Date,
            triggerNode: '#beginTime',
            finalTriggerNode: '#endTime',
            count: 1,
            isHoliday: false,
            minDate: true,
            maxDate: true
        });

        $(".calendar-input-wrap").css("display", "inline");

        return calendar;
    },{
        requires: ['node', 'gallery/calendar/1.2/index']
    });

    //DropList
    KISSY.add('DropList', function(S, Node, DropList) {
        var $ = Node.all;

        // console.log( View );

        //方案商下拉列
        var droplist1 = new DropList({
            // 设置初始化选择项。
            selectedItem: {
                value: "55",
                text: "列表项55"
                // value: "${imeiUpload.solutionProviders}",
                // text: "${imeiUpload.solutionProviders}"
            },
            // freedom: true,
            // customData: { text: "列表项55" },
            // 现有的结构选择器或者元素
            custom: true,
            insertion: "#plan",
            // fieldName: "solutionProviders",
            // 直接传入数据。
            // 数据格式需要有text和value。且value不允许重复。
            // 什么是标准数据
            dataSource: 
            // ${solutionProviders}
            [
                {text: "列表项1", value: 1},
                {text: "列表项2", value: 2}
            ]
        });
        droplist1.on('blur', function(ev) {
            // 获取当前选项的数据。
            var data = ev.data ? ev.data.text : '',
                el = $( '#planVal' );

            el.val( data );
            el.fire( 'keyup' );
        });
        // render以后才渲染结构。包括事件绑定，和初始化选择触发。
        droplist1.render();

        //主板下拉列
        var droplist2 = new DropList({
            // 设置初始化选择项。
            selectedItem: {
                value: "4",
                text: "列表项4"
                // value: "${imeiUpload.broadType}",
                // text: "${imeiUpload.broadType}"
            },
            // 现有的结构选择器或者元素
            insertion: "#board",
            custom: true,
            // fieldName: "broadType",
            // 直接传入数据。
            // 数据格式需要有text和value。且value不允许重复。
            // 什么是标准数据
            dataSource: 
            // ${broadType}
            [
                {text: "列表项1", value: 1},
                {text: "列表项2", value: 2},
                {text: "列表项3", value: 3},
                {text: "列表项4", value: 4}
            ]
        });
        droplist2.on('blur', function(ev) {
            // 获取当前选项的数据。
            var data = ev.data ? ev.data.text : '',
                el = $( '#boardVal' );

            el.val( data );
            el.fire( 'keyup' );
        });
        // render以后才渲染结构。包括事件绑定，和初始化选择触发。
        droplist2.render();

        //活动下拉列
        var droplist3 = new DropList({
            // 设置初始化选择项。
            selectedItem: {
                value: "2",
                text: "列表项2"
                // value: "${imeiUpload.activity}",
                // text: "${imeiUpload.activity}"
            },
            // 现有的结构选择器或者元素
            insertion: "#active",
            custom: true,
            // fieldName: "activity",
            // 直接传入数据。
            // 数据格式需要有text和value。且value不允许重复。
            // 什么是标准数据
            dataSource: 
            // ${activity}
            [
                {text: "列表项1", value: 1},
                {text: "列表项2", value: 2},
                {text: "列表项3", value: 3}
            ]
        });
        droplist3.on('blur', function(ev) {
            // 获取当前选项的数据。
            var data = ev.data ? ev.data.text : '',
                el = $( '#activeVal' );

            el.val( data );
            el.fire( 'keyup' );
        });
        // render以后才渲染结构。包括事件绑定，和初始化选择触发。
        droplist3.render();
        
    },{
        requires: ['node', 'droplist/droplist']
        // requires: ['node', 'gallery/droplist/0.3/index']
    });
</script>
<!--================================ js  }} ===============================-->

</body>
</html>
